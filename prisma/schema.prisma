// prisma/schema.prisma
// Healthcare Worker Clock-In/Out System Database Schema
// Following 2025 Prisma + Next.js best practices with complete beginner explanations

// 🔧 GENERATOR: Tells Prisma what client code to generate for your app
generator client {
  provider = "prisma-client-js"  // Creates TypeScript client with full type safety
}

// 🔌 DATASOURCE: Tells Prisma how to connect to your database
datasource db {
  provider  = "postgresql"           // We're using PostgreSQL (Supabase)
  url       = env("DATABASE_URL")    // Pooled connection for app operations
  directUrl = env("DIRECT_URL")      // Direct connection for migrations
}


// 👥 USERS MODEL  
// This represents healthcare workers (nurses, doctors, technicians, managers, etc.)
model users {
  // 📋 PRIMARY KEY: Unique identifier for each user
  id              String   @id @default(cuid())
  
  // 👤 USER AUTHENTICATION & PROFILE
  email           String   @unique              // Email from Auth0 (must be unique)
  name            String?                       // Full name (optional)
  role            String   @default("worker")   // "worker", "manager", "admin"
  
  // 📊 ACCOUNT STATUS
  active          Boolean  @default(true)       // Whether account is active
  
  // ⏰ TIMESTAMPS
  created_at      DateTime @default(now())      // When user joined system
  updated_at      DateTime @updatedAt           // Last profile update

  // 🔗 RELATIONSHIPS: How this connects to other tables
  // Each user can have many shifts
  shifts       shifts[]     // All shifts this user has worked

  // 🎯 TABLE NAME MAPPING
  @@map("users")
}

// ⏰ SHIFTS MODEL
// This represents individual work sessions from clock-in to clock-out
model shifts {
  // 📋 PRIMARY KEY: Unique identifier for each shift
  id                   String    @id @default(cuid())
  
  // 👤 WHO & WHERE: Links to user and their workplace
  user_id              String    // Which healthcare worker
  
  // 🟢 CLOCK-IN DATA: When worker starts their shift
  clock_in_time        DateTime  // Exact timestamp when clocked in
  clock_in_latitude    Float     // GPS location where worker clocked in
  clock_in_longitude   Float     // GPS location where worker clocked in
  
  // 🔴 CLOCK-OUT DATA: When worker ends their shift (optional until they clock out)
  clock_out_time       DateTime? // Timestamp when clocked out (null = still working)
  clock_out_latitude   Float?    // GPS location where worker clocked out
  clock_out_longitude  Float?    // GPS location where worker clocked out
  
  // 📝 ADDITIONAL SHIFT DATA
  notes                String?   // Optional notes about the shift
  duration_minutes     Int?      // Total shift length (calculated on clock-out)
  
  // ⏰ RECORD TIMESTAMPS
  created_at          DateTime  @default(now()) // When shift record was created
  updated_at          DateTime  @updatedAt      // Last time shift was updated

  // 🔗 RELATIONSHIPS: How shifts connect to users
  user         users         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  // 🎯 TABLE NAME MAPPING
  @@map("shifts")
  
  // 📈 DATABASE INDEXES: Make queries faster (2025 best practice)
  @@index([user_id])                    // Fast lookup of user's shifts
  @@index([clock_in_time])              // Fast lookup by date/time
  @@index([user_id, clock_out_time])    // Fast lookup of active shifts
}
